kind: pipeline
type: exec
name: deploy

trigger:
  event:
    - push
  branch:
    - main

steps:
  - name: deploy
    environment:
      FLY_API_TOKEN:
        from_secret: FLY_API_TOKEN
    commands:
      - nix run .#deploy
---
kind: pipeline
type: docker
name: daily-backup
trigger:
  event:
    - cron

steps:
  - name: update flakes
    image: nixpkgs/nix-flakes:nixos-22.05
    commands:
      - nix flake update --commit-lock-file
      - nix develop -c git push origin --all
